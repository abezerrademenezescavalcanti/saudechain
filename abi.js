const RegMedABI = [{"constant":false,"inputs":[{"name":"_recordId","type":"uint248"}],"name":"makeRecordNotSellable","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_pacientAddress","type":"address"},{"name":"_recordId","type":"uint32"}],"name":"getPatientRecordDetails","outputs":[{"name":"","type":"bytes10"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"bool"},{"name":"","type":"bool"},{"name":"","type":"string"},{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint248"}],"name":"recordsAvailableToSell","outputs":[{"name":"patient","type":"address"},{"name":"recordCode","type":"uint32"},{"name":"price","type":"uint256"},{"name":"stillSellable","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_acct","type":"address"},{"name":"_name","type":"string"},{"name":"_country","type":"string"}],"name":"newThirdPartyIssuer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"thirdPartyIssuersAvailable","outputs":[{"name":"name","type":"string"},{"name":"country","type":"string"},{"name":"exists","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"voteForNewDeveloperVotes","outputs":[],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[],"name":"voteForNewDeveloper","outputs":[],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"_acct","type":"address"}],"name":"getThirdPartyIssuerDetails","outputs":[{"name":"name","type":"string"},{"name":"country","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_recordId","type":"uint248"},{"name":"_purpose","type":"string"}],"name":"askToBuy","outputs":[{"name":"newID","type":"uint248"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"_orderId","type":"uint248"}],"name":"getRecordSoldDetails","outputs":[{"name":"","type":"bytes10"},{"name":"","type":"string"},{"name":"","type":"uint256"},{"name":"","type":"string"},{"name":"","type":"string"},{"name":"","type":"bool"},{"name":"","type":"bool"},{"name":"","type":"string"},{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getTotalRecordAvailableToSell","outputs":[{"name":"","type":"uint248"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_pacientAddress","type":"address"},{"name":"_recordId","type":"uint32"},{"name":"_mediaUrl","type":"string"},{"name":"_externalIssuer","type":"address"}],"name":"addMediaToRecord","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_pacientAddress","type":"address"}],"name":"getTotalPatientRecords","outputs":[{"name":"","type":"uint32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_devAccount","type":"address"},{"name":"_comission","type":"uint64"},{"name":"_votes","type":"uint8"}],"name":"newDeveloper","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_recordId","type":"uint248"}],"name":"getRecordSellable","outputs":[{"name":"patient","type":"address"},{"name":"recordCategoryCode","type":"bytes10"},{"name":"price","type":"uint256"},{"name":"stillSellable","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalDevelopers","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_code","type":"bytes10"},{"name":"description","type":"string"}],"name":"newRecordCategory","outputs":[{"name":"status","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_devID","type":"address"}],"name":"getSingleDeveloper","outputs":[{"name":"devAccount","type":"address"},{"name":"comission","type":"uint256"},{"name":"votes","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_pacientAddress","type":"address"},{"name":"_recordCategoryCode","type":"bytes10"},{"name":"_dateOfFact","type":"string"},{"name":"_details","type":"string"},{"name":"_externalIssuer","type":"address"}],"name":"newRecord","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalRecordCategories","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_acct","type":"address"},{"name":"_dateOfBirth","type":"string"},{"name":"_genderOfBirth","type":"string"},{"name":"_cityOfBirth","type":"string"},{"name":"_countryOfBirth","type":"string"},{"name":"_ethnicity","type":"string"}],"name":"newPatient","outputs":[{"name":"status","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_acct","type":"address"}],"name":"allowIssuers","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"voteForChangeCommission","outputs":[],"payable":false,"stateMutability":"pure","type":"function"},{"constant":true,"inputs":[{"name":"_code","type":"bytes10"}],"name":"getRecordCategory","outputs":[{"name":"code","type":"bytes10"},{"name":"description","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_orderID","type":"uint248"}],"name":"sell","outputs":[{"name":"success","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"_recordId","type":"uint32"},{"name":"_price","type":"uint64"}],"name":"makeRecordSellable","outputs":[{"name":"newID","type":"uint248"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_acct","type":"address"}],"name":"getPatientDetails","outputs":[{"name":"dateOfBirth","type":"string"},{"name":"genderOfBirth","type":"string"},{"name":"cityOfBirth","type":"string"},{"name":"countryOfBirth","type":"string"},{"name":"ethnicity","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"developerAccounts","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getLastRecordOrderId","outputs":[{"name":"","type":"uint248"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[],"payable":true,"stateMutability":"payable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_recipient","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"ComissionPayed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_patient","type":"address"},{"indexed":false,"name":"_value","type":"uint256"},{"indexed":false,"name":"_recordOrderId","type":"uint248"}],"name":"RecordBuyed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"purpose","type":"string"},{"indexed":false,"name":"valueOffered","type":"uint256"},{"indexed":false,"name":"_recordOrderId","type":"uint248"}],"name":"NewOrder","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"category","type":"bytes10"},{"indexed":false,"name":"price","type":"uint256"},{"indexed":false,"name":"recordSellableId","type":"uint248"}],"name":"NewRecordAvailableToBuy","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"patient","type":"address"},{"indexed":false,"name":"recordId","type":"uint32"}],"name":"NewRecordToPatient","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"patient","type":"address"},{"indexed":false,"name":"recordId","type":"uint32"}],"name":"NewMediaToPatientRecord","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"code","type":"bytes10"}],"name":"NewCategory","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"parter","type":"address"}],"name":"NewThirdPartyIssuer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"patientAddress","type":"address"}],"name":"NewPatient","type":"event"}];

var web3;
var contract;

if (typeof web3 !== 'undefined') {
    web3 = new Web3(web3.currentProvider);
} else {
    web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/QPF0qjGpH9OjFuuMrCse"))
}
contract = web3.eth.contract(RegMedABI).at("0x1f80b33057b1f9f4b1f93e8348bdc46594ac66f5"); 

function waitForTxToBeMined(txHash, objStatus) {
    let txReceipt;
    web3.eth.getTransactionReceipt(txHash, function (err, result) {
        if (err) {
            console.error(err);
            return;
        }        
        txReceipt = result;
        console.log("txHash: " + txHash);
        console.log(txReceipt); 
        if (txReceipt) {
            if (txReceipt.status == "0x1") {
                $(objStatus).css("background-color", "LawnGreen");
                $(objStatus).html("Record successfuly saved at block: " + txReceipt.blockNumber + " - Transaction hash: " + txHash);            
            } else {
                $(objStatus).css("background-color", "Salmon");
                $(objStatus).html("There was an error - Transaction hash: " + txHash + " final status: " + txReceipt.status);            
            }
        } else {
            window.setTimeout(waitForTxToBeMined, 1500, txHash, objStatus);
        }
    });
}
